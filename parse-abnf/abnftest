#!/usr/bin/perl -w

use strict;
use Data::Dumper;
use ABNF;

die "Usage: abnftest rule data (give rules on standard input)\n" unless scalar @ARGV == 2;

my @rules = <STDIN>;
my $rule = shift;
my $data = shift;
my $obj = Parse::ABNF->new(@rules);

#Print a version of obj without the core rules
my $printobj = {};
my $key;
%$printobj = %$obj;
foreach $key(keys %$printobj) {
	delete $printobj->{$key} if $printobj->{$key}->{core};
}
warn Data::Dumper->new([$printobj])->Terse(1)->Dump(), "\n============\n";

my $parse = $obj->matches($rule, $data, "*");
die "No match!\n" unless $parse;
$obj->printparse($parse);
